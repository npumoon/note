## 锁

排他锁：X 锁

共享锁：S 锁

锁的算法实现
1. Record Key : 单记录锁
2. Gap Key ： 间隙锁，不包含边界。
3. Next-Key ： 1+2，锁定一个范围，包含记录本身

### 版本
1. 系统版本号：一个递增的数字，每开始一个新的事务，系统版本号自动递增。
2. 事务版本号：事务开始时的系统版本号。

每行记录后面保存两个隐藏的列来实现MVCC，创建时间[系统版本号]，过期时间[删除时间]。

### 非一致性锁定读
 
> 非锁定：不需要等待访问的行上X锁（排他锁）的释放
 
 **MVCC** （multi version concurrency control）
 
 利用读取快照的方式，解决行记录被锁住时的其他线程读取行为。
 
 快照有多个版本
 > `Read-Committed` 隔离级别下，对于快照数据，非一致性读总是读取被锁定行的最新一份快照信息。
 > 而 `Repeatable-Read` 隔离级别下，对于快照数据，非一致性读总是读取事务开始时的行数据版本。

### 一致性的锁定读

1.  select ... for update 

    加排他锁 （X锁）

2.  select ... LOCK IN SHARE MODE

    加共享锁（S锁）
    


 
 ---
 ***补充***
 
 快照数据是指该行的之前版本的数据，这部分数据是通过 **undo段**来完成，undo 用来在事务中回滚数据，因此快照数据本身**没有额外的开销**。
    
    
 
 
 
